###############################################################
# Eclipse Tractus-X - Industry Core Hub
#
# Copyright (c) 2025 Contributors to the Eclipse Foundation
#
# See the NOTICE file(s) distributed with this work for additional
# information regarding copyright ownership.
#
# This program and the accompanying materials are made available under the
# terms of the Apache License, Version 2.0 which is available at
# https://www.apache.org/licenses/LICENSE-2.0.
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
# WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
# License for the specific language governing permissions and limitations
# under the License.
#
# SPDX-License-Identifier: Apache-2.0
###############################################################
---
## Example configuration for Keycloak authentication
## This file extends the base values.yaml with Keycloak-specific settings
## Usage: helm install industry-core-hub . -f values.yaml -f values-keycloak.yaml

# Frontend configuration with Keycloak authentication
frontend:
  config:
    # Authentication configuration
    authEnabled: true
    authProvider: "keycloak"  # Enable Keycloak authentication
    
    # Session management
    authSessionTimeout: 3600000  # 1 hour in milliseconds
    authRenewTokenMinValidity: 300  # 5 minutes in seconds
    authLogoutRedirectUri: "https://<frontend-hostname>"
    
    # Keycloak configuration
    keycloak:
      url: "https://<keycloak-hostname>/auth"
      realm: "ICHub"
      clientId: "industry-core-hub-frontend"
      onLoad: "login-required"  # check-sso, login-required
      checkLoginIframe: false
      silentCheckSsoRedirectUri: ""
      pkceMethod: "S256"
      enableLogging: false
      minValidity: 30
      checkLoginIframeInterval: 5
      flow: "standard"  # standard, implicit, hybrid
      realmImport:
        enabled: true
        method: "job"
        availabilityCheck:
          timeout: "120s"
          delay: "5s"

# Backend configuration with Keycloak authentication
backend:
  configuration:
    authorization:
      enabled: true
      apiKey:
        key: "X-Api-Key"
        value: ["<example>"]  # Fallback API key
      keycloak:
        enabled: true  # Enable Keycloak authentication
        authUrl: "https://<keycloak-hostname>/auth/"
        realm: "ICHub"
        clientId: "industry-core-hub-api"
        clientSecret: "<client-secret>"
        retry:
          maxRetries: 5
          retryDelay: 10
          backgroundRetryInterval: 60

# Keycloak deployment configuration
keycloak:
  enabled: true
  
  # Realm import configuration
  realmImport:
    enabled: true
    method: "job"  # Use job-based import for dynamic password setting
    availabilityCheck:
      timeout: "120s"
      delay: "5s"
  
  # Realm user configuration
  realm:
    name: "ICHub"
    users:
      - username: "ichub-admin"
        password: "changeme"  # Change this password in production
        email: "ichub-admin@example.com"
        firstName: "Industry"
        lastName: "Admin"
        emailVerified: true
        enabled: true
        attributes:
          BPN: ["BPNL000000000000"]
        realmRoles:
          - "default-roles-ichub"
          - "offline_access"
          - "uma_authorization"
  
  # Keycloak ingress configuration
  ingress:
    enabled: true
    hostname: "<keycloak-hostname>"
    annotations:
      nginx.ingress.kubernetes.io/use-regex: "true"
      # cert-manager.io/cluster-issuer: "letsencrypt-prod"
    tls: false
